/**
* Polytate v1.0.1
*
* The MIT License (MIT)
* 
* Copyright (c) 2013 Klaas Van Parys (Warsaalk)
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy of
* this software and associated documentation files (the "Software"), to deal in
* the Software without restriction, including without limitation the rights to
* use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
* the Software, and to permit persons to whom the Software is furnished to do so,
* subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
* FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
* COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
* IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
* CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
**/
;(function(e){function t(e){var t=[],n=this.getElementsByTagName("*");for(var r=0,i=n.length;r<i;r++){if(n[r].className.contains(e))t.push(n[r])}return t}function n(){}function r(){var e=this;this.DOM={items:[],panes:[],convex:document.createElement("div"),wrap:document.createElement("div")};this.indices=[];this.maxPane=0;this.triggers={};this.state={lastPane:-1,angle:0,lastOpposite:0,initialRotation:0};this.options={appendTo:null,context:document,forceReload:false,preLoad:false,beforeRotate:function(){},orientation:0,reverse:false,allowTrigger:false};this.transformation={rotate:"rotateY",operand:1,transformPane:function(e,t,n){t=this.processAngle(t);e.style[$PT.browser.Transform]=this.rotate+"("+t+"deg) translateZ("+n+"px)"},transformConvex:function(t,n){t=this.processAngle(t);e.DOM.convex.style[$PT.browser.Transform]="translateZ(-"+n+"px) "+this.rotate+"("+t+"deg)"},processAngle:function(e){return e*this.operand}}}if(!String.prototype.contains){String.prototype.contains=function(e){return this.indexOf(e)!==-1?true:false}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){for(var t=0,n=this.length;t<n;t++){if(this[t]==e)return t}return-1}}if(!Element.prototype.addEventListener){Element.prototype.addEventListener=function(e,t,n){var r=this;r.attachEvent("on"+e,function(e){t.call(this,e,r)})}}if(!Element.addClass&&!Element.removeClass){Element.prototype.addClass=function(e){if(typeof this.classList!=="undefined"){this.classList.add(e)}else{var t=(this.className.length===0?"":" ")+e;if(!this.className.contains(e))this.className+=t}};Element.prototype.removeClass=function(e){if(typeof this.classList!=="undefined"){this.classList.remove(e)}else{var t=(this.className==e?"":" ")+e;if(this.className.contains(e))this.className=this.className.replace(t,"")}}}document.getElementsByClassName=document.getElementsByClassName||t;Element.prototype.getElementsByClassName=Element.prototype.getElementsByClassName||t;if(!Event.prototype.preventDefault){Event.prototype.preventDefault=function(){this.returnValue=false}}n.prototype.preventDefault=function(){};e.FakeEvent=n;r.prototype.getItems=function(){var e=[],t=this.options.context;if(typeof t==="string"){t=document.querySelectorAll(t)}else if(t.nodeType){t=[t]}if(t.length){for(var n=0,r=t.length;n<r;n++){e=e.concat(Array.prototype.slice.call(t[n].getElementsByClassName("polytate-item")))}}return e};r.prototype.initTrigger=function(e,t){var n=document.createElement("a");n.href=e;n.setAttribute("polytate-turnindex",t);if(!$PT.support3d)n.setAttribute("polytate-no3d",1);if(/^https?:\/\//i.test(e))e=e.split("/").pop();this.triggers[e]=n};r.prototype.triggerPane=function(e){if("undefined"!==typeof this.triggers[e]){this.changePanel(this.triggers[e],new n)}};r.prototype.createConvex=function(){var e=document.getElementsByTagName("body")[0];this.DOM.convex.className="polytate-convex";this.DOM.wrap.className="polytate-wrap";this.DOM.wrap.appendChild(this.DOM.convex);if(this.options.appendTo){var t=document.getElementById(this.options.appendTo);if(t)e=t}e.appendChild(this.DOM.wrap)};r.prototype.initPanes=function(){if(!$PT.support3d)this.initPane($PT.no3dIndex);var e=0,t=this;for(var n=0,r=this.DOM.items.length;n<r;n++){var i=this.indices.indexOf(this.DOM.items[n].href);if(i==-1){if($PT.support3d)this.initPane(e);this.indices[e]=this.DOM.items[n].href;this.DOM.items[n].setAttribute("polytate-turnindex",e);if(this.options.allowTrigger){this.initTrigger(this.DOM.items[n].href,e)}if($PT.support3d&&this.options.preLoad)$PT.loadPage(this.DOM.items[n],this.DOM.panes[e]);e++}else{this.DOM.items[n].setAttribute("polytate-turnindex",i)}if(!$PT.support3d)this.DOM.items[n].setAttribute("polytate-no3d",1);this.DOM.items[n].addEventListener("click",function(e,n){t.changePanel(n||this,e)},false)}this.state.angle=360/this.DOM.panes.length};r.prototype.initPane=function(e){var t=document.createElement("div"),n=document.createTextNode("This is pane "+e);t.className="polytate-pane";t.setAttribute("polytate-state","inited");this.DOM.panes[e]=t;this.DOM.convex.appendChild(this.DOM.panes[e])};r.prototype.changePanel=function(e,t){t.preventDefault();var n=e.hasAttribute("polytate-no3d"),r=e.getAttribute("polytate-turnindex"),i=n?this.DOM.panes[$PT.no3dIndex]:this.DOM.panes[r],s=i.getAttribute("polytate-state"),o=false;if(this.state.lastPane!=-1)this.DOM.items[this.state.lastPane].removeClass("polytate-selected");this.DOM.items[r].addClass("polytate-selected");if(typeof this.options.beforeRotate==="function")this.options.beforeRotate.call(null,e,i);if(n||r==this.state.lastPane&&this.options.forceReload)o=true;else{if(r!=this.state.lastPane){if(this.state.lastPane==-1)this.state.lastPane=0;var u=0;if(r==0&&this.state.lastPane==this.maxPane)u=1;else if(r==this.maxPane&&this.state.lastPane==0)u=-1;else u=r-this.state.lastPane;this.state.initialRotation-=this.state.angle*u;this.transformation.transformConvex(this.state.initialRotation,this.state.lastOpposite);o=!(s=="loaded"&&!this.options.forceReload)}}if(o)$PT.loadPage(e,i);this.state.lastPane=r};r.prototype.initConvex=function(){if(!$PT.support3d)return;var e=this.options.orientation===$PT.VERTICAL?this.DOM.convex.clientHeight:this.DOM.convex.clientWidth;var t=e/2,n=(180-this.state.angle)/2,r=n*Math.PI/180,i=Math.tan(r)*t;this.state.lastOpposite=i;for(var s=0,o=this.DOM.panes.length;s<o;s++){var u=this.DOM.panes[s],a=this.state.angle*s;if(this.state.angle==360){a=0;i=0}if(this.state.angle==180&&s>0)i=1;this.transformation.transformPane(u,a,i)}this.transformation.transformConvex(this.state.initialRotation,this.state.lastOpposite);this.DOM.convex.style[$PT.browser.TransformOrigin]="50% 50%";this.DOM.wrap.style[$PT.browser.Perspective]=e*this.DOM.panes.length+"px"};var s=$PT={HORIZONTAL:0,VERTICAL:1,READY:0,INITED:1,browser:{Transform:"transform",TransformStyle:"transformStyle",TransformOrigin:"transformOrigin",Perspective:"perspective"},support3d:false,no3dIndex:"no3d",ajaxLoader:false,instances:[],state:0,init:function(){$PT.initJsTransformProps();$PT.test3dSupport();if(typeof e.jQuery!=="undefined")$PT.ajaxLoader=true;$PT.state=$PT.INITED;return $PT.support3d},createInstance:function(e){if($PT.state===$PT.READY)$PT.init();var t=new r;t.options=$PT.mergeObjects(t.options,e||{});t.DOM.items=t.getItems();if(t.options.orientation===$PT.VERTICAL)t.transformation.rotate="rotateX";if(t.options.reverse!==false)t.transformation.operand=-1;t.createConvex();t.initPanes();if($PT.support3d){t.initConvex()}t.maxPane=t.indices.length-1;$PT.instances.push(t);return t},initJsTransformProps:function(){if(e.getComputedStyle){var t=e.getComputedStyle(document.documentElement,""),n="";if(typeof t.webkitTransform!=="undefined")n="Webkit";if(typeof t.MozTransform!=="undefined")n="Moz";if(typeof t.msTransform!=="undefined")n="ms";if(typeof t.oTransform!=="undefined")n="O";if(n!=""){$PT.browser.Transform=n+"Transform";$PT.browser.TransformStyle=n+"TransformStyle";$PT.browser.TransformOrigin=n+"TransformOrigin";$PT.browser.Perspective=n+"Perspective"}}},test3dSupport:function(){var e=document.createElement("div");if(e.style[$PT.browser.TransformStyle]!==undefined){e.style[$PT.browser.TransformStyle]="preserve-3d";if(e.style[$PT.browser.TransformStyle]=="preserve-3d")$PT.support3d=true}},reloadConvexes:function(){for(var e=0,t=$PT.instances.length;e<t;e++){$PT.instances[e].initConvex()}},loadPage:function(e,t,n){$PT.clearPane(t);var r=e.href,i=document.createElement("div");i.className="polytate-loader";t.appendChild(i);var s={url:r,dataType:"html",beforeSend:function(n,r){n.PolytatePane=t;n.PolytateItem=e},success:$PT.ajax.Success,error:$PT.ajax.Error};s=$PT.mergeObjects(s,n);$.ajax(s)},clearPane:function(e){while(e.firstChild){e.removeChild(e.firstChild)}},ajax:{Success:function(e,t,n){var r=n.PolytatePane;$(r).html(e);r.setAttribute("polytate-state","loaded");if(r.scrollHeight>r.offsetHeight)r.addClass("polytate-scrollbar")},Error:function(e,t,n){var r=e.PolytatePane;$(r).html("<h1>Could not handle page request</h1>");r.setAttribute("polytate-state","failed")}},mergeObjects:function(e,t){var n=e;for(i in t){n[i]=t[i]}return n}};e.onresize=$PT.reloadConvexes;e.Polytate=$PT})(window)